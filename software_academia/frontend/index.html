<!DOCTYPE html>
<html lang="e">
<head>
    <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Churn Prediction (IA) – Dashboard</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    :root{--bg:#0f172a;--panel:#0b1220;--panel-2:#111827;--muted:#94a3b8;--brand:#3b82f6;--ok:#22c55e;--warn:#f59e0b;--bad:#ef4444}
    body{background: radial-gradient(1200px 800px at 60% -10%,#122034 0%,#0b1220 40%,#0a0f1a 100%) fixed}
    .glass{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));backdrop-filter:blur(8px)}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.06)}
    .pill{border:1px solid rgba(255,255,255,.08)}
    .progress{height:8px;border-radius:999px;background:#0f172a;position:relative}
    .progress>span{position:absolute;inset:0 100% 0 0;border-radius:999px}
    .grid-bg{background-image:radial-gradient(rgba(255,255,255,.06) 1px, transparent 1px);background-size:22px 22px}
    .table-row:hover{background-color:rgba(255,255,255,.04)}
  </style>
</head>
<body class="text-slate-200">
  <div class="min-h-screen flex">
    <!-- Sidebar -->
    <aside class="w-64 hidden md:flex flex-col space-y-2 p-4 bg-slate-900/60 border-r border-white/10">
      <div class="flex items-center gap-2 px-2 py-3">
        <div class="h-8 w-8 rounded-lg bg-sky-500 grid place-content-center font-bold">E</div>
        <span class="font-semibold">Escuela</span>
      </div>
      <nav class="flex-1 space-y-1">
        <button class="w-full text-left px-3 py-2 rounded-xl pill hover:bg-white/10 flex items-center gap-2 bg-white/10">
          <i data-lucide="layout-dashboard" class="w-4 h-4"></i> Dashboard
        </button>
        <button class="w-full text-left px-3 py-2 rounded-xl pill hover:bg-white/10 flex items-center gap-2">
          <i data-lucide="users" class="w-4 h-4"></i> Estudiantes
        </button>
        <button class="w-full text-left px-3 py-2 rounded-xl pill hover:bg-white/10 flex items-center gap-2">
          <i data-lucide="credit-card" class="w-4 h-4"></i> Pagos
        </button>
        <button class="w-full text-left px-3 py-2 rounded-xl pill hover:bg-white/10 flex items-center gap-2">
          <i data-lucide="bot" class="w-4 h-4"></i> Churn IA
        </button>
        <button class="w-full text-left px-3 py-2 rounded-xl pill hover:bg-white/10 flex items-center gap-2">
          <i data-lucide="repeat" class="w-4 h-4"></i> Automatizaciones
        </button>
        <button class="w-full text-left px-3 py-2 rounded-xl pill hover:bg-white/10 flex items-center gap-2">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i> Reportes
        </button>
        <button class="w-full text-left px-3 py-2 rounded-xl pill hover:bg-white/10 flex items-center gap-2">
          <i data-lucide="settings" class="w-4 h-4"></i> Ajustes
        </button>
      </nav>
      <div class="mt-auto text-xs text-slate-400 px-2">v1.0</div>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-4 md:p-8 grid-bg">
      <!-- Top bar -->
      <header class="flex items-center justify-between mb-6">
        <div>
          <h1 class="text-xl md:text-2xl font-semibold">Churn Prediction (IA)</h1>
          <p class="text-slate-400 text-sm">Panel de riesgo, ingresos y acciones sugeridas</p>
        </div>
        <div class="flex items-center gap-2">
          <button id="howBtn" class="pill px-3 py-2 rounded-xl hover:bg-white/10 flex items-center gap-2">
            <i data-lucide="info" class="w-4 h-4"></i>
            ¿Cómo es calculado?
          </button>
          <div class="h-9 w-9 rounded-full bg-sky-600 grid place-content-center font-medium">JA</div>
        </div>
      </header>

      <!-- KPI cards -->
      <section class="grid md:grid-cols-3 gap-4 mb-6">
        <div class="card rounded-2xl p-4">
          <div class="flex items-start justify-between">
            <div>
              <p class="text-slate-400 text-xs">Students in high risk</p>
              <div class="text-3xl font-bold">18</div>
            </div>
            <span class="px-2 py-1 text-xs rounded-full bg-emerald-500/15 text-emerald-300 border border-emerald-500/30">Revenue at risk</span>
          </div>
          <div class="mt-3 progress"><span style="width:68%;background:linear-gradient(90deg,#ef4444,#f59e0b)"></span></div>
        </div>
        <div class="card rounded-2xl p-4">
          <div class="flex items-start justify-between">
            <div>
              <p class="text-slate-400 text-xs">Ingresos del mes</p>
              <div class="text-3xl font-bold">$5,800</div>
            </div>
            <span class="px-2 py-1 text-xs rounded-full bg-red-500/15 text-red-300 border border-red-500/30">Riesgo alto</span>
          </div>
          <div class="mt-3 progress"><span style="width:45%;background:linear-gradient(90deg,#f59e0b,#ef4444)"></span></div>
        </div>
        <div class="card rounded-2xl p-4">
          <p class="text-slate-400 text-xs mb-2">Top Drivers (Explicabilidad)</p>
          <div class="space-y-3">
            <Driver label="Low Attendance" value="70" />
            <Driver label="Low Grades" value="49" />
            <Driver label="Lack of Interaction" value="30" />
          </div>
        </div>
      </section>

      <!-- Filters -->
      <section class="flex flex-wrap gap-3 mb-6">
        <div class="pill rounded-xl px-3 py-2 flex items-center gap-2">
          <i data-lucide="filter" class="w-4 h-4"></i> Filtro:
        </div>
        <Select id="courseSelect" options="Todos,A1,A2,B1,B2" />
        <Select id="riskSelect" options="Todos,High,Medium,Low" />
        <Select id="daysSelect" options="Últimos 30 días,Últimos 60 días,Últimos 90 días" />
        <div class="relative">
          <input id="searchInput" placeholder="Buscar estudiante..." class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-500"/>
        </div>
      </section>

      <!-- Prioritized list (mini gauge) -->
      <section class="card rounded-2xl p-4 mb-6 overflow-hidden">
        <p class="text-sm text-slate-300 mb-3">Prioritized List</p>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="space-y-2">
            <span class="text-xs text-slate-400">Student (0-100)</span>
            <div class="progress"><span style="width:90%;background:linear-gradient(90deg,#ef4444,#f59e0b)"></span></div>
            <div class="progress"><span style="width:60%;background:linear-gradient(90deg,#3b82f6,#06b6d4)"></span></div>
          </div>
          <div class="space-y-2">
            <span class="text-xs text-slate-400">Payment</span>
            <div class="progress"><span style="width:30%;background:linear-gradient(90deg,#ef4444,#f59e0b)"></span></div>
            <div class="progress"><span style="width:80%;background:linear-gradient(90deg,#22c55e,#86efac)"></span></div>
          </div>
          <div class="space-y-2">
            <span class="text-xs text-slate-400">Engagement</span>
            <div class="progress"><span style="width:40%;background:linear-gradient(90deg,#f59e0b,#fde047)"></span></div>
            <div class="progress"><span style="width:72%;background:linear-gradient(90deg,#3b82f6,#06b6d4)"></span></div>
          </div>
        </div>
      </section>

      <!-- Table + Action plan -->
      <section class="grid lg:grid-cols-3 gap-4">
        <!-- Table -->
        <div class="lg:col-span-2 card rounded-2xl overflow-hidden">
          <div class="px-4 py-3 border-b border-white/10 flex items-center justify-between">
            <span class="text-sm text-slate-300">Alumnos</span>
            <span class="text-xs text-slate-400" id="countInfo"></span>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="bg-white/5 text-slate-400">
                <tr>
                  <th class="text-left px-4 py-2">Alumno</th>
                  <th class="text-left px-4 py-2">Razón</th>
                  <th class="text-left px-4 py-2">Pago</th>
                  <th class="text-left px-4 py-2">Último Pago</th>
                  <th class="text-left px-4 py-2">Acciones</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Plan of Action -->
        <div class="card rounded-2xl p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold">Plan of Action</h3>
            <span class="text-xs text-slate-400">IA Sugerencias</span>
          </div>
          <ol class="list-decimal ml-5 space-y-2 text-sm" id="planList">
            <li>Personalizar SMS</li>
            <li>Enviar email personalizado</li>
            <li>Ofrecer descuento/plan flexible</li>
            <li>Agendar llamada</li>
            <li>Seguimiento en X días</li>
          </ol>
          <button id="suggestBtn" class="mt-4 w-full px-3 py-2 rounded-xl bg-sky-600 hover:bg-sky-500">Sugerir Plan</button>
        </div>
      </section>

      <!-- Modal: how it works -->
      <dialog id="howModal" class="rounded-2xl p-0 w-[90%] md:w-[640px] bg-slate-900 text-slate-200 border border-white/10">
        <div class="p-5">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold">¿Cómo calculamos el riesgo de churn?</h3>
            <button class="pill px-2 py-1 rounded-lg" onclick="howModal.close()">Cerrar</button>
          </div>
          <ul class="text-sm text-slate-300 space-y-2 list-disc ml-5">
            <li>Modelo supervisado (Random Forest) entrenado con pagos, asistencia y notas.</li>
            <li>Se estandarizan variables y se generan features (tendencias 30/60/90 días).</li>
            <li>La probabilidad &gt; 0.7 se marca como Alto, 0.4–0.7 Medio, &lt; 0.4 Bajo.</li>
            <li>Los "Top Drivers" provienen de la importancia de variables (permutation importance).</li>
          </ul>
        </div>
      </dialog>
    </main>
  </div>

  <!-- Reusable tiny components (JS renders them) -->
  <template id="rowTpl">
    <tr class="table-row border-b border-white/5">
      <td class="px-4 py-3">
        <div class="flex items-center gap-3">
          <div class="h-8 w-8 rounded-full bg-sky-600 grid place-content-center text-xs font-medium">AV</div>
          <div>
            <div class="font-medium name">Nombre</div>
            <div class="text-xs text-slate-400 email">email</div>
          </div>
        </div>
      </td>
      <td class="px-4 py-3">
        <span class="reason inline-flex items-center gap-2 px-2 py-1 rounded-full text-xs border"></span>
      </td>
      <td class="px-4 py-3 amount">$0</td>
      <td class="px-4 py-3 last">—</td>
      <td class="px-4 py-3">
        <button class="px-3 py-1 rounded-lg bg-white/10 hover:bg-white/20 text-xs">Ver</button>
      </td>
    </tr>
  </template>

  <script>
    // ----- Icons -----
    document.addEventListener('DOMContentLoaded', () => lucide.createIcons());

    // ----- Drivers component (simple HTML generator) -----
    function Driver({label,value}){
      return `<div class=\"p-3 rounded-xl bg-white/5 border border-white/10\">
        <div class=\"flex items-center justify-between mb-2\">
          <div class=\"flex items-center gap-2\"><i data-lucide=\"alert-triangle\" class=\"w-4 h-4 text-yellow-400\"></i><span class=\"text-sm\">${label}</span></div>
          <span class=\"text-xs text-slate-400\">${value}%</span>
        </div>
        <div class=\"progress\"><span style=\"width:${value}%;background:linear-gradient(90deg,#f59e0b,#fde047)\"></span></div>
      </div>`
    }
    // Inject driver cards
    document.querySelectorAll('Driver').forEach(el=>{
      const html = Driver({label: el.getAttribute('label'), value: el.getAttribute('value')});
      el.outerHTML = html;
    });

    // ----- Select pill component -----
    function Select({id, options}){
      const opts = options.split(',').map(o=>`<option>${o}</option>`).join('');
      return `<select id=${id} class=\"bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-500\">${opts}</select>`;
    }
    document.querySelectorAll('Select').forEach(el=>{
      const html = Select({id: el.getAttribute('id'), options: el.getAttribute('options')});
      el.outerHTML = html;
    });

    // ----- Mock data -----
    const DATA = [
      { id:1, name:'Ana Rodríguez', email:'ana.rodriguez@mail.com', reason:'Low Attendance', risk:'High', amount:120, last:'Dec 15', course:'A1' },
      { id:2, name:'Juan Perez', email:'juan.perez@mail.com', reason:'Overdue Payment', risk:'High', amount:90, last:'Dec 03', course:'A2' },
      { id:3, name:'Ana Rodrimax', email:'ana.rodri@mail.com', reason:'Low Grades', risk:'Medium', amount:88, last:'Nov 28', course:'B1' },
      { id:4, name:'Carlos Sánchez', email:'c.sanchez@mail.com', reason:'Lack of Engagement', risk:'Medium', amount:59, last:'Nov 26', course:'B2' },
      { id:5, name:'Carla Sanchez', email:'carla.s@mail.com', reason:'Re-enrollment Soon', risk:'Low', amount:246, last:'Nov 20', course:'A1' },
      { id:6, name:'Ria Rentry', email:'ria.rentry@mail.com', reason:'Low Attendance', risk:'High', amount:110, last:'Nov 15', course:'A2' },
    ];

    // ----- Rendering -----
    const $tbody = document.getElementById('tableBody');
    const $tpl = document.getElementById('rowTpl');
    const $count = document.getElementById('countInfo');

    function badgeColor(reason){
      if(reason.includes('Attendance')) return 'text-yellow-300 border-yellow-400/40 bg-yellow-500/10';
      if(reason.includes('Overdue')) return 'text-emerald-300 border-emerald-400/40 bg-emerald-500/10';
      if(reason.includes('Grades')) return 'text-red-300 border-red-400/40 bg-red-500/10';
      if(reason.includes('Engagement')) return 'text-sky-300 border-sky-400/40 bg-sky-500/10';
      return 'text-slate-300 border-white/20 bg-white/5';
    }

    function render(rows){
      $tbody.innerHTML = '';
      rows.forEach(r=>{
        const node = $tpl.content.cloneNode(true);
        node.querySelector('.name').textContent = r.name;
        node.querySelector('.email').textContent = r.email;
        const reason = node.querySelector('.reason');
        reason.textContent = r.reason;
        reason.className = `reason inline-flex items-center gap-2 px-2 py-1 rounded-full text-xs border ${badgeColor(r.reason)}`;
        node.querySelector('.amount').textContent = `$${r.amount}`;
        node.querySelector('.last').textContent = r.last;
        $tbody.appendChild(node);
      });
      $count.textContent = `${rows.length} resultados`;
      lucide.createIcons();
    }

    // Initial render
    render(DATA);

    // ----- Filters -----
    const $course = document.getElementById('courseSelect');
    const $risk = document.getElementById('riskSelect');
    const $days = document.getElementById('daysSelect');
    const $search = document.getElementById('searchInput');

    function applyFilters(){
      const q = $search.value.toLowerCase();
      const c = $course.value; const r = $risk.value; // days mocked
      const filtered = DATA.filter(row =>
        (c==='Todos' || row.course===c) &&
        (r==='Todos' || row.risk===r) &&
        (row.name.toLowerCase().includes(q) || row.email.toLowerCase().includes(q))
      );
      render(filtered);
    }

    [$course,$risk,$days,$search].forEach(el=> el.addEventListener('input', applyFilters));

    // ----- Modal logic -----
    const howModal = document.getElementById('howModal');
    const howBtn = document.getElementById('howBtn');
    howBtn.addEventListener('click', ()=> howModal.showModal());

    // ----- Suggest plan (toy) -----
    const plans = [
      ['Personalizar SMS','Recordatorio de pago','Enviar landing con botón de pago','Agendar llamada','Seguimiento en 3 días'],
      ['Email con plan flexible','Cupón del 10%','Video de progreso académico','Agenda con coordinación','Encuesta de satisfacción'],
      ['Mensaje WhatsApp','Beca parcial por rendimiento','Llamada de tutor','Invitar a taller gratuito','Revisión en 7 días'],
    ];
    document.getElementById('suggestBtn').addEventListener('click', ()=>{
      const list = document.getElementById('planList');
      const p = plans[Math.floor(Math.random()*plans.length)];
      list.innerHTML = p.map(step=>`<li>${step}</li>`).join('');
    });
  </script>
</body>
</html>


